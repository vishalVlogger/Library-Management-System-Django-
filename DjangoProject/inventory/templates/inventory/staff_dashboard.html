{% extends "inventory/base.html" %} {% load tz %} {%block title %} Staff
Dashboard {% endblock %} {% block content %}
<div class="container mt-5">
  <h2 class="mb-4 text-center">üìä Staff Dashboard</h2>

  <div class="row">
    <!-- Book Management -->
    <h2 class="mt-5 mb-3">üìö Book Management</h2>
      <div class="table-responsive">
        <table class="table table-striped table-bordered align-middle">
          <thead class="table-dark">
            <tr>
              <th>Title</th>
              <th>Author</th>
              <th>Category</th>
              <th>Stock</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for book in books %}
            <tr>
              <td>{{ book.title }}</td>
              <td>{{ book.authors }}</td>
              <td>
                {% if book.category %}
                  {{ book.category.name }}
                {% else %}
                  N/A
                {% endif %}
              </td>
              <td>{{ book.available_quantity }}</td>
              <td>
                <div class="d-flex justify-content-center gap-2 flex-wrap">
                  <a href="{% url 'inventory:view_book' book.pk %}" class="btn btn-info btn-sm">
                    <i class="bi bi-eye"></i> View
                  </a>
                  <a href="{% url 'inventory:edit_book' book.pk %}" class="btn btn-warning btn-sm">
                    <i class="bi bi-pencil-square"></i> Edit
                  </a>
                  <form action="{% url 'inventory:delete_book' book.pk %}" method="post" style="display:inline;">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-danger btn-sm">
                      <i class="bi bi-trash"></i> Delete
                    </button>
                  </form>
                </div>
              </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="5" class="text-center">No books available.</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>


    <!-- User Information -->
    <div class="col-md-6 mb-4">
      <div class="card shadow-sm p-3">
        <h4 class="mb-3">üë• Registered Users</h4>
        <table class="table table-bordered text-center">
          <thead>
            <tr>
              <th>Username</th>
              <th>Email</th>
              <th>Staff</th>
            </tr>
          </thead>
          <tbody>
            {% for user in users %}
            <tr>
              <td>{{ user.username }}</td>
              <td>{{ user.email }}</td>
              <td>{% if user.is_staff %} ‚úÖ {% else %} ‚ùå {% endif %}</td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="3" class="text-center">No users found.</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Transactions Table -->
  <div class="row mt-4">
    <div class="col-12">
      <div class="card shadow-sm p-3">
        <h4 class="mb-3">üìë Transactions</h4>
        <table
          class="table table-striped table-bordered text-center align-middle"
        >
          <thead class="table-dark">
            <tr>
              <th>#</th>
              <th>Member</th>
              <th>Book</th>
              <th>Quantity</th>
              <th>Issue Date</th>
              <th>Return Date</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody>
            {% for txn in transactions %}
            <tr>
              <td>{{ forloop.counter }}</td>
              <td>{{ txn.member.user.username }}</td>
              <td>{{ txn.book.title }}</td>
              <td>{{ txn.quantity }}</td>

              <td>
                {% if txn.issue_date %} {{ txn.issue_date|localtime|date:"d M Y, H:i" }} {% else %} &mdash; {% endif %}
              </td>

              <td>
                {% if txn.return_date %} {{ txn.return_date|localtime|date:"d M Y, H:i" }} {% else %} &mdash; {% endif %}
              </td>

              <td>
                {% if txn.transaction_type == 'RETURN' %}
                <span class="text-success fw-bold">Returned</span>
                {% else %}
                <span class="text-danger fw-bold">Not Returned</span>
                {% endif %}
              </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="7" class="text-center">No transactions found.</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
{% endblock %}
